**Date:** 2025‑08‑17  
**File:** 2025‑08‑17_1.0.3+8_06_ai_bot_coaching_chat.md
**Purpose:** Confirm that coaches and clients can converse with the **AIAI Assistant** by text and (on mobile) speech‑to‑text, that responses render correctly, and that ancillary actions (audio playback, copy, refresh) work as intended.

---

# Test Scenario – AI Coaching Chat

## 0  Pre‑conditions
- User is signed‑in  
- Stable internet connection (≥ 2 Mbps)  

---

## A  Open Chat

1. **Tap “Chat With AI”** in sidebar  
   - URL path `/chatAIScreen` loads without 404  
   - Header text “Chat with AI✨” visible  
   - Refresh icon (⟳) top‑right present and enabled  

2. **Initial assistant message**  
   - Bubble text “Hello! How can I assist you today?” appears in ≤ 2 s  
   - Speaker button (🔊) inside bubble visible  
   - Sub‑label “Generated with AI” and **Copy response** link shown  

---

## B  Send Text Message (Desktop & Mobile)

| Checkpoint | Validation Rules | Expected Result |
|------------|------------------|-----------------|
| **Message input field** | Placeholder “Write a message …” | Field gains focus on tap / click |
| Characters | Min 1, Max 2 048 | Counter turns red if limit exceeded |
| Allowed charset | UTF‑8; emojis; punctuation; no script tags `<script>` | Unsafe chars escaped |
| Line breaks | Shift + Enter inserts newline | Message retains formatting in bubble |
| **Send button** | Solid arrow icon | Disabled when input empty; becomes active on valid text |
| Submit via Enter | Enter key without Shift sends | Same behaviour as button |
| Loading state | Spinner replaces arrow ≤ 500 ms | Spinner disappears after response |

3. **Assistant response**  
   - Appears in new bubble beneath user message  
   - Average latency ≤ 5 s  
   - Long responses auto‑scroll chat to latest bubble  

4. **Copy response link**  
   - Copies exact text to clipboard (paste into Notes to verify)  
   - Toast *“Copied”* displayed  

---

## C  Speech‑to‑Text (Mobile Only)

| Step | Detail | Expected |
|------|--------|----------|
| **Microphone icon** | Located inside message field, right side | Visible when keyboard closed |
| Tap icon | OS microphone permission prompt if first time | Choose **Allow** |
| Recording | Level meter animates while speaking | Transcribed text appears live in input |
| Stop recording | Auto stops on 3 s silence **or** tap icon again | Icon reverts; transcription ready for edit |
| Validation | Same min / max / charset rules as text | Errors shown inline |
| Send | Tap arrow | Message bubble shows spoken text |

---

## D  Text‑to‑Speech Playback (All Platforms)

1. **Tap speaker button (🔊)** in any assistant bubble  
   - Audio plays via system output  
   - Second tap pauses playback  
   - Navigating away stops audio  

2. **Volume / route change**  
   - Adjust device volume → playback volume changes  
   - Connect Bluetooth headset → audio routes correctly  

---

## E  Refresh Conversation

1. **Tap refresh icon (⟳)**  
   - Tap **refresh icon (⟳)** → chat history empties; initial assistant greeting reappears  

---

## F  Error Handling

| Scenario | Trigger | Expected UI |
|----------|---------|-------------|
| Backend timeout | Simulate by disabling internet, send message | Error toast *“Unable to reach server”*; retry icon in bubble |
| Invalid token | Force logout while tab open | Redirect to Sign In screen |
| Character overflow | > 2 048 chars pasted | Inline error “Character limit exceeded” |

---

## 1  Expected Outcome
- Users can exchange unlimited messages with AI within validation limits  
- Speech‑to‑text reliably captures input on mobile when permission granted  
- Audio playback and copy actions work on every assistant response  
- Refresh clears history without residual data  

---

## Test Checklist

| Test | Pass |
|---|---|
| User is signed-in | ✅ |
| Internet bandwidth ≥ 2 Mbps | ✅ |
| Sidebar shows **Chat With AI** item | ✅ |
| Tapping Chat With AI navigates to `/chatAIScreen` | ✅ |
| `/chatAIScreen` returns HTTP 200 (no 404) | ✅ |
| Header text “Chat with AI✨” is visible | ✅ |
| Refresh icon ⟳ is visible | ✅ |
| Refresh icon is enabled (clickable) | ✅ |
| Initial assistant message appears ≤ 2 s | ❌ **Issue location:** Chat with AI screen. **Where:** Upon opening `/chatAIScreen`. **Details:** No initial message is displayed; screen remains blank until user sends a message. |
| Initial bubble text = “Hello! How can I assist you today?” | ❌ **Issue location:** Chat with AI screen. **Where:** Expected first bubble. **Details:** Initial greeting bubble never appears. |
| Speaker button 🔊 inside initial bubble visible | ✅ |
| Sub-label “Generated with AI” present | ✅ |
| **Copy response** link present | ✅ |
| **Message input** placeholder = “Write a message …” | ✅ |
| Tapping input gives it keyboard focus | ✅ |
| Typing 1 character enables Send arrow | ❌ **Issue location:** Chat with AI screen → input field. **Where:** Text entry. **Details:** Blank messages can be sent; Send arrow is active even with no characters typed. |
| Typing > 2 048 chars turns counter red | ❌ **Issue location:** Chat with AI screen → input field. **Where:** Character count limit. **Details:** No visible character counter; input accepts unlimited characters. |
| Pasting > 2 048 chars shows overflow error | ❌ **Issue location:** Chat with AI screen → input field. **Where:** Paste handling. **Details:** No overflow error displayed; accepts all pasted text lengths. |
| Input accepts emojis | ✅ |
| Input escapes `<script>` tags | ❌ **Issue location:** Chat with AI screen → input field. **Where:** Special characters handling. **Details:** `<script>` tags are rendered unescaped in message preview, potential XSS risk. |
| Shift + Enter inserts newline | ✅ |
| Newline formatting preserved in sent bubble | ✅ |
| Send arrow disabled when input empty | ❌ **Issue location:** Chat with AI screen → input field. **Where:** Empty state. **Details:** Send arrow remains active even when the field is empty. |
| Send arrow enabled when input has valid text | ✅ |
| Pressing Enter (no Shift) sends message | ❌ **Issue location:** Chat with AI screen → input field. **Where:** Keyboard shortcuts. **Details:** Pressing Enter inserts a new line instead of sending the message. |
| On send, arrow replaced by spinner ≤ 500 ms | ✅ |
| Spinner disappears after assistant reply | ✅ |
| Assistant reply bubble appears below user message | ✅ |
| Reply latency ≤ 5 s | ✅ |
| Long reply auto-scrolls chat to bottom | ✅ |
| Copy link on reply copies exact text | ✅ |
| Copy action shows toast “Copied” | ✅ |
| Tap speaker 🔊 plays TTS audio | ❌ **Issue location:** Chat with AI screen. **Where:** Audio handling. **Details:** TTS is not playing on PC. |
| Second tap pauses TTS playback | ✅ |
| Navigating away stops TTS playback | ❌ **Issue location:** Chat with AI screen. **Where:** Audio handling. **Details:** TTS continues playing after navigating to other screens. |
| Changing device volume changes playback volume | ✅ |
| Connecting Bluetooth routes playback to headset | ✅ |
| Mic icon visible in input (keyboard closed) | ✅ |
| First mic tap shows permission prompt | ✅ |
| Selecting Allow enables recording | ✅ |
| Level meter animates while speaking | ❌ **Issue location:** Chat with AI screen (mobile). **Where:** Speech-to-text recording UI. **Details:** No level meter animation shown during recording. |
| Live transcription appears in input | ❌ **Issue location:** Chat with AI screen (mobile). **Where:** Speech-to-text. **Details:** Transcription appears only after recording stops, not live while speaking. |
| Recording stops on 3 s silence | ❌ **Issue location:** Chat with AI screen (mobile). **Where:** Recording stop triggers. **Details:** Recording continues indefinitely; silence detection not working. |
| Tap mic again stops recording | ✅ |
| Transcribed text obeys min/max/charset rules | ❌ **Issue location:** Chat with AI screen (mobile). **Where:** Input validation after transcription. **Details:** No enforcement of min/max length or restricted characters for STT input. |
| Send arrow submits spoken text | ✅ |
| Refresh icon tap clears all chat bubbles | ✅ |
| After refresh, initial greeting bubble reappears | ❌ **Issue location:** Chat with AI screen → after refresh. **Where:** Expected initial message. **Details:** Refresh clears bubbles but no greeting bubble is reloaded. |
| Disable internet, send message → toast “Unable to reach server” | ❌ **Issue location:** Chat with AI screen. **Where:** Network error handling. **Details:** App spins indefinitely; no error toast shown. |
| Timeout bubble shows retry icon | ❌ **Issue location:** Chat with AI screen. **Where:** Timeout handling. **Details:** No retry icon appears; message remains stuck in loading state. |
| For retry bubble, tapping retry after re-connect sends | ❌ **Issue location:** Chat with AI screen. **Where:** Retry action. **Details:** Feature not available due to missing retry icon. |
| Force logout token expiry redirects to Sign In screen | ✅ |
| Attempt to paste > 2 048 chars shows inline “Character limit exceeded” | ❌ **Issue location:** Chat with AI screen → input field. **Where:** Paste validation. **Details:** No inline error displayed; accepts all pasted text. |
| User can send multiple messages sequentially | ✅ |
| AI can send multiple responses sequentially | ✅ |
| No message duplication occurs on rapid sends | ✅ |
| Chat history not stored after refresh | ✅ |
| Speech-to-text usable again after refresh | ✅ |
| Copy link works on every assistant bubble | ✅ |
| Speaker 🔊 works on every assistant bubble | ❌ **Issue location:** Chat with AI screen. **Where:** Audio handling. **Details:** TTS is not playing on PC. |
| If one speaker starts, the other stops | ❌ **Issue location:** Chat with AI screen → TTS playback. **Where:** Multiple audio streams. **Details:** Multiple assistant bubbles can play audio simultaneously instead of stopping the previous one. |